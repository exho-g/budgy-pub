import{r as w,G as S,k as V,p as k,o as f,f as e,v as L,i as A,u as h,C as q,t as c,n as O,x as F,s as T,g as M,F as N,q as E,m as I,P as J,j as W,c as U,w as Y,B as P,I as G,K as B,L as K,e as Q,Q as H}from"./index-BBC1P1kV.js";import{g as j}from"./useIconGetter-BffgHyQ9.js";import{A as X}from"./arrow-right-DB1HUtDb.js";import{W as Z,f as ee}from"./dateUtils-Blb5nBSr.js";import{_ as te}from"./Modal-Bbokac-i.js";import{_ as R}from"./TextField-DHM_XWB9.js";import{_ as ae}from"./SelectField-B06SVX_c.js";import{T as ne}from"./triangle-alert--wnXekSy.js";const le={class:"flex gap-2 justify-between items-center mb-4"},oe={class:"text-center"},se={class:"text-xs font-bold"},re={key:0,class:"bg-linear-to-b from-primary/20 -mx-5 px-5 py-4 mb-4 flex justify-between items-center"},ue={class:"text-2xl font-bold mt-1"},ce=["disabled"],ie={key:1,class:"flex justify-center items-center h-32"},de={key:2,class:"text-center text-gray-500 mt-18"},me={class:"text-center"},ye={key:3,class:"list bg-base-100 rounded-box shadow-md dark:bg-gray-800"},be={class:"flex gap-2 justify-between items-center w-full"},ge={class:"font-bold"},ve={key:0,class:"text-warning inline-block ml-1"},fe={class:"items-end flex flex-col justify-center"},pe={class:"text-xs text-blue-500"},xe={class:"text-xs text-orange-500"},he={__name:"Transactions",props:["account"],emits:["useCycleAmount"],setup(s){const $=s,n=w([]),p=w(!0),D=w(null),g=w(null),l=w([]),b=w(0),v=(y,t=0)=>{const i=new Date;let o,d;if(y.type==="Credit"){const m=y.statementDay||1,C=new Date(i.getFullYear(),i.getMonth()+t,m);i.getDate()>=m?(o=new Date(C.getFullYear(),C.getMonth(),m+1),d=new Date(C.getFullYear(),C.getMonth()+1,m)):(o=new Date(C.getFullYear(),C.getMonth()-1,m+1),d=new Date(C.getFullYear(),C.getMonth(),m))}else{const m=new Date(i.getFullYear(),i.getMonth()+t,1);o=new Date(m.getFullYear(),m.getMonth(),1),d=new Date(m.getFullYear(),m.getMonth()+1,0)}return{startDate:o,endDate:d}},_=async()=>{l.value=await I("categories")},x=async(y=0)=>{var o;if(!$.account)return;p.value=!0;const{startDate:t,endDate:i}=v($.account,y);D.value=t,g.value=i,n.value=await J($.account.id,D.value,g.value),n.value=n.value.map(d=>{var C;const m=(C=l.value)==null?void 0:C.find(z=>z.id===d.categoryId);return{...d,category:m}}),b.value=0,(o=n.value)==null||o.forEach(d=>{d.isCCPay||(b.value+=d.amount)}),p.value=!1};S(()=>$.account,()=>{x()},{immediate:!0}),V(()=>{_(),x()});const u=w(0),a=()=>{u.value-=1,x(u.value)},r=()=>{u.value+=1,x(u.value)};return(y,t)=>{var i;return f(),k("div",null,[e("div",le,[e("button",{class:"btn btn-secondary btn-sm btn-soft btn-circle",onClick:a},[A(h(q))]),e("div",oe,[t[1]||(t[1]=e("h2",{class:"text-secondary font-bold text-lg"},"Transactions",-1)),e("p",se,c(D.value?D.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"")+" - "+c(g.value?g.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""),1)]),e("button",{class:"btn btn-secondary btn-circle btn-soft btn-sm",onClick:r},[A(h(O))])]),((i=s.account)==null?void 0:i.type)=="Credit"?(f(),k("div",re,[e("div",null,[t[2]||(t[2]=e("span",{class:"badge badge-primary badge-soft rounded-md text-xs"},"Total for this billing cycle",-1)),e("p",ue,c(h(F)(b.value)),1)]),e("div",null,[e("button",{class:T(["btn btn-primary rounded-xl font-bold btn-sm outline-2 outline-offset-3",{"outline-primary":b.value>0,"outline-gray-300/50":b.value<=0}]),disabled:b.value<=0,onClick:t[0]||(t[0]=o=>y.$emit("useCycleAmount",b.value))},[t[3]||(t[3]=M(" Pay ")),A(h(X),{size:"16"})],10,ce)])])):L("",!0),p.value?(f(),k("div",ie,t[4]||(t[4]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):n.value.length===0?(f(),k("div",de,[e("div",me,[A(h(Z),{size:"82",class:"inline-block text-gray-300"})]),t[5]||(t[5]=e("p",{class:"text-balance max-w-10/12 m-auto"}," No transactions found for the current date range. ",-1))])):(f(),k("ul",ye,[(f(!0),k(N,null,E(n.value,o=>{var d,m;return f(),k("li",{class:T(["list-row",{"bg-green-50 dark:bg-green-800/30":o.isCCPay}]),key:o.id},[e("div",be,[e("div",null,[e("p",ge,[e("span",{class:T({"text-green-500":((d=o.category)==null?void 0:d.type)=="Income","text-red-500":((m=o.category)==null?void 0:m.type)=="Expense"})},c(h(F)(o.amount)),3),o.isInstallment?(f(),k("span",ve,"("+c(o.installmentPosition+"/"+o.installmentMonths)+" month"+c(o.installmentMonths>1?"s":"")+")",1)):L("",!0)]),e("p",{class:T(["text-xs",{"text-green-500 font-bold":o.isCCPay}])},c(o.label),3)])]),e("div",fe,[e("p",pe,c(new Date(o.time).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1),e("p",xe,c(o.category?`${o.category.name} (${o.category.type})`:""),1)])],2)}),128))]))])}}},De={class:"mb-4 mt-4 bg-linear-to-r from-secondary/5 to-secondary/30 p-2 rounded-lg outline-2 outline-secondary outline-offset-4"},we={class:"font-bold text-orange-500 dark:text-orange-400"},Ce={class:"flex justify-between items-center"},ke={class:"text-red-700 dark:text-red-400"},$e={class:"text-red-700 dark:text-red-400 py-1 px-2 rounded-md text-xs bg-red-500/20"},_e={class:"mt-4 mb-6"},Ae={class:"text-center -mt-2"},Te={key:0,role:"alert",class:"alert alert-error alert-soft"},Fe={class:"grid grid-cols-2 text-center mb-4"},Le={__name:"Pay",props:{account:{type:Object,default:null},useCycleAmount:{type:Boolean,default:!1},cycleAmount:{type:Number,default:0}},emits:["refresh","cycleAmountUsed"],setup(s,{emit:$}){var _,x;const n=s,p=w([]),D=async()=>{p.value=await I("accounts")};V(()=>{D()});const g=$,l=w({time:ee(new Date),amount:0,cardType:"Debit",accountId:"",label:`Pay ${(_=n.account)==null?void 0:_.name}`,type:"Income",categoryId:null,isCCPay:!0,ccId:(x=n.account)==null?void 0:x.id,isInstallment:!1,installmentId:null,installmentMonths:0,installmentPosition:1});S(()=>n.account,u=>{u&&(l.value.amount=parseFloat(u.balance).toFixed(2)||0,l.value.ccId=u.id||null,l.value.label=`Pay ${u.name}`)}),S(()=>n.useCycleAmount,u=>{u&&(l.value.amount=parseFloat(n.cycleAmount).toFixed(2),g("cycleAmountUsed"))});const b=W(()=>{var u,a;return[{label:"Out Source / Cash",value:""},...(a=(u=p.value)==null?void 0:u.filter(r=>{var y;return r.id!=((y=n.account)==null?void 0:y.id)&&r.type===l.value.cardType}))==null?void 0:a.map(r=>({label:r.name+" / "+r.type+" "+F(r.type=="Debit"?r.amount:r.creditLimit-r.balance),value:r.id}))]}),v=async()=>{var r;if(!l.value.amount||l.value.amount<=0){alert("Please enter a valid amount.");return}const u=JSON.parse(JSON.stringify(l.value)),a=await K(u);a.success?((r=document.querySelector("#accounts-pay-modal"))==null||r.close(),g("refresh")):console.error("Failed to save payment:",a.error)};return(u,a)=>(f(),U(te,{id:"accounts-pay-modal",modalTitle:"Pay Balance",isForm:"",submit:v,formButtonLabel:"Pay",closeLabel:"Cancel"},{default:Y(()=>{var r,y;return[e("div",De,[e("p",we,c((r=s.account)==null?void 0:r.name),1),e("div",Ce,[e("p",ke,[a[7]||(a[7]=e("strong",null,"Balance:",-1)),M(" "+c(h(F)((y=s.account)==null?void 0:y.balance)),1)]),e("p",$e,[a[8]||(a[8]=e("strong",null,"Due Date:",-1)),M(" "+c((()=>{var i;const t=new Date;return t.setDate(((i=s.account)==null?void 0:i.statementDay)||1),t.setDate(t.getDate()+20),t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)])])]),e("div",_e,[P(e("input",{id:"transaction-amount","onUpdate:modelValue":a[0]||(a[0]=t=>l.value.amount=t),type:"number",step:"0.01",placeholder:"0.00",required:"",class:"text-center w-full font-bold text-5xl outline-none",min:"0.01"},null,512),[[G,l.value.amount]]),a[9]||(a[9]=e("p",{class:"text-center -mt-3"},[e("label",{for:"transaction-amount",class:"font-bold inline-block text-secondary"},"Amount")],-1)),e("p",Ae,[e("span",{class:"link text-orange-500 inline-block ml-1 text-xs",onClick:a[1]||(a[1]=()=>{var t;l.value.amount=parseFloat(((t=n.account)==null?void 0:t.balance)||0).toFixed(2)})},"(Tap here for Max Balance)")])]),l.value.amount>s.account.balance?(f(),k("div",Te,[A(h(ne)),a[10]||(a[10]=e("span",null,"You are about to pay more than your current account balance.",-1))])):L("",!0),A(R,{modelValue:l.value.time,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.time=t),label:"Payment Time",type:"datetime-local",required:""},null,8,["modelValue"]),a[13]||(a[13]=e("p",{class:"mt-8 mb-2 font-bold text-primary"},"Account to Pay",-1)),e("div",Fe,[e("label",{class:T(["cursor-pointer font-bold text-sm border-2 border-gray-500 rounded-xl rounded-r-none border-r-0 py-2",{"bg-linear-to-r from-gray-900 to-gray-600 text-white":l.value.cardType==="Credit","bg-transparent text-gray-500":l.value.cardType!=="Credit"}])},[a[11]||(a[11]=e("span",{class:"block"},"Credit",-1)),P(e("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=t=>l.value.cardType=t),value:"Credit",class:"hidden"},null,512),[[B,l.value.cardType]])],2),e("label",{class:T(["cursor-pointer font-bold text-sm border-2 border-gray-500 rounded-xl rounded-l-none border-l-0 py-2",{"bg-linear-to-l from-gray-900 to-gray-600 text-white":l.value.cardType==="Debit","bg-transparent text-gray-500":l.value.cardType!=="Debit"}])},[a[12]||(a[12]=e("span",{class:"block"},"Debit",-1)),P(e("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=t=>l.value.cardType=t),value:"Debit",class:"hidden"},null,512),[[B,l.value.cardType]])],2)]),A(ae,{modelValue:l.value.accountId,"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.accountId=t),options:b.value,label:"Account",required:""},null,8,["modelValue","options"]),A(R,{modelValue:l.value.label,"onUpdate:modelValue":a[6]||(a[6]=t=>l.value.label=t),label:"Label",placeholder:"Payment Label"},null,8,["modelValue"])]}),_:1}))}},Pe={class:"text-2xl text-primary dark:text-teal-400 font-black"},Se=["value"],Me={class:"font-bold"},Ue={class:"font-bold text-red-500 dark:text-red-400"},Ve={class:"flex justify-between bg-orange-500/10 -mx-4 mt-2 px-4 py-2 -mb-10 rounded-b-xl"},Ie={class:"text-lg font-bold"},Be={class:"text-right"},je={class:"text-lg font-bold"},Re={class:"text-center"},Ne=["disabled"],Ye={__name:"AmountCard",props:{account:{type:Object,default:null}},emits:["refresh","resetCycleAmount"],setup(s){return($,n)=>{var p,D,g,l,b,v,_,x,u,a,r,y,t,i,o;return f(),k("div",{class:T(["bg-white dark:bg-gray-700 rounded-xl shadow-xl z-[2] relative -mt-10 p-4 mb-12",{"shadow-orange-500/20 dark:shadow-orange-700/10":((p=s.account)==null?void 0:p.type)==="Credit","shadow-secondary/20 dark:shadow-secondary/10":((D=s.account)==null?void 0:D.type)==="Debit"}])},[e("p",null,[e("small",null,c(((g=s.account)==null?void 0:g.type)=="Credit"?"Remaining Credits":"Balance"),1)]),e("p",Pe,c(h(F)(((l=s.account)==null?void 0:l.type)=="Credit"?((b=s.account)==null?void 0:b.creditLimit)-((v=s.account)==null?void 0:v.balance):(_=s.account)==null?void 0:_.amount)),1),((x=s.account)==null?void 0:x.type)==="Credit"?(f(),k(N,{key:0},[e("progress",{class:"progress progress-primary dark:bg-teal-500/30 dark:text-teal-200 w-full",value:((u=s.account)==null?void 0:u.balance)/((a=s.account)==null?void 0:a.creditLimit)*100||0,max:"100"},null,8,Se),e("p",Me,[e("small",null,"Statement Date: "+c(new Date(new Date().setDate(((r=s.account)==null?void 0:r.statementDay)||1)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1)]),e("p",Ue,[e("small",null,"Due Date: "+c((()=>{var m;const d=new Date;return d.setDate(((m=s.account)==null?void 0:m.statementDay)||1),d.setDate(d.getDate()+20),d.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)]),e("div",Ve,[e("div",null,[n[1]||(n[1]=e("p",{class:"font-bold"},[e("small",null,"Credit Limit")],-1)),e("p",Ie,c(h(F)((y=s.account)==null?void 0:y.creditLimit)),1)]),e("div",Be,[n[2]||(n[2]=e("p",{class:"font-bold"},[e("small",null,"Balance")],-1)),e("p",je,c(h(F)((t=s.account)==null?void 0:t.balance)),1)])]),e("div",Re,[e("button",{disabled:!((i=s.account)!=null&&i.balance),class:T(["btn btn-circle btn-primary bg-linear-to-t from-teal-800 to-teal-500 outline-2 outline-offset-2 outline-primary btn-md text-white font-bold shadow-xl -mb-16 -mt-4 shadow-primary/50",{"grayscale-100":!((o=s.account)!=null&&o.balance)}]),onClick:n[0]||(n[0]=d=>$.$emit("resetCycleAmount",0))}," Pay ",10,Ne)])],64)):L("",!0)],2)}}},ze={class:"relative -mx-5 -mt-2 p-5 min-h-48"},qe={class:"relative z-[2] max-w-10/12 h-full"},Oe={class:"w-14 h-12 bg-white dark:bg-gray-800 px-2 py-1 mb-2 rounded-md"},Ee=["src","alt"],Je={class:"text-white text-xl font-black"},We={class:"w-6/12 h-10/12 absolute top-6/12 right-5 -translate-y-6/12 z-[0]"},Ge=["src","alt"],Ke={class:"border-2 border-dashed bg-gray-200 border-gray-300 rounded-xl p-2 mb-8 dark:bg-gray-800"},Qe={class:"italic"},ot={__name:"View",setup(s){const $=H(),n=w(null),p=w(!1),D=w(0),g=async()=>{n.value=await I("accounts",$.params.id)},l=b=>{var v;p.value=!0,D.value=b,(v=document.querySelector("#accounts-pay-modal"))==null||v.showModal()};return V(()=>{g()}),(b,v)=>(f(),U(Q,{pageTitle:(n.value?n.value.type:"")+" Account",isSubNav:"",bg:"bg-gray-100 dark:bg-gray-900"},{default:Y(()=>{var _,x,u,a,r,y,t,i,o;return[e("div",ze,[e("div",qe,[e("div",Oe,[e("img",{src:h(j)((_=n.value)==null?void 0:_.cardType),alt:(x=n.value)==null?void 0:x.cardType,class:"w-full h-full object-contain"},null,8,Ee)]),e("h2",Je,c(((u=n.value)==null?void 0:u.name)||"Account"),1)]),e("div",{class:T(["w-full h-full bg-linear-to-r absolute top-0 left-0 z-[1] backdrop-blur-xs",{"from-secondary to-secondary/50":((a=n.value)==null?void 0:a.type)==="Debit","from-warning to-warning/50":((r=n.value)==null?void 0:r.type)==="Credit","from-gray-500 to-gray-500/50":!n.value}])},null,2),e("div",We,[e("img",{src:h(j)((y=n.value)==null?void 0:y.bank),alt:(t=n.value)==null?void 0:t.bank,class:"w-full h-full object-contain"},null,8,Ge)])]),A(Ye,{account:n.value,onRefresh:g,onResetCycleAmount:l},null,8,["account"]),e("div",Ke,[v[1]||(v[1]=e("p",{class:"font-bold text-xs"},"Note:",-1)),e("p",Qe,c(((i=n.value)==null?void 0:i.comment)||"--"),1)]),A(he,{account:n.value,onUseCycleAmount:l},null,8,["account"]),(o=n.value)!=null&&o.balance?(f(),U(Le,{key:0,account:n.value,useCycleAmount:p.value,cycleAmount:D.value,onRefresh:g,onCycleAmountUsed:v[0]||(v[0]=()=>{p.value=!1})},null,8,["account","useCycleAmount","cycleAmount"])):L("",!0)]}),_:1},8,["pageTitle"]))}};export{ot as default};
