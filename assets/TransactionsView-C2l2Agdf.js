import{p as B,q as W,j as y,o as u,s as Y,b as I,v as J,a as l,x as R,t as p,d as F,m as w,r as _,y as X,c as V,w as M,h as g,l as $,u as x,I as j,F as P,z as G,A as H,k as U,n as D,B as K,e as Q,_ as Z,g as ee,f as N,C as te,i as ae}from"./index-B3fSrwim.js";import{_ as T}from"./Modal-C4Bhvrem.js";import{_ as O}from"./TextField-CPm8t0_q.js";import{_ as z}from"./SelectField-IySsiNI7.js";import{f as S,W as le}from"./dateUtils-BwFrET23.js";import{S as E}from"./star-Omz2k3Dp.js";import{X as se,_ as oe,P as ne}from"./FAB-B9lZLoyu.js";const re={class:"flex items-center gap-2"},ie=["value"],ue={__name:"CheckboxField",props:B({label:{type:String,default:null},value:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const h=W(c,"modelValue");return(r,b)=>(u(),y("label",re,[Y(l("input",R({type:"checkbox","onUpdate:modelValue":b[0]||(b[0]=m=>h.value=m),class:"checkbox checkbox-sm checkbox-primary",value:c.value},r.$attrs),null,16,ie),[[J,h.value]]),I(" "+p(c.label??c.value),1)]))}},ce={key:0,class:"alert alert-soft alert-warning mt-4"},de={key:2,class:"my-4"},me={class:"alert alert-soft"},ye={class:"my-4 text-sm"},pe={__name:"Form",props:{transaction:{type:Object,default:null},categories:{type:Array,default:[]},accounts:{type:Array,default:[]}},emits:["close"],setup(c,{emit:h}){const r=c,b=h,m=F(()=>{var e;return(e=r.categories)==null?void 0:e.slice().sort((a,s)=>a.type===s.type?a.name.localeCompare(s.name):a.type.localeCompare(s.type)).map(a=>({label:`${a.name} (${a.type})`,value:a.id}))}),d=F(()=>{var a,s;let e=(s=(a=r.accounts)==null?void 0:a.slice())==null?void 0:s.filter(i=>{var v;return((v=r.transaction)==null?void 0:v.ccId)!==i.id}).sort((i,v)=>i.type===v.type?i.name.localeCompare(v.name):i.type.localeCompare(v.type)).map(i=>({label:`${i.name} / ${i.type} ${w(i.type=="Debit"?i.amount:i.creditLimit-i.balance)}`,value:i.id}));return[{label:"Out Source / Cash",value:""},...e]}),n={id:null,amount:null,time:S(new Date),categoryId:"",accountId:"",label:"",isCCPay:!1,ccId:null,isInstallment:!1,installmentId:null,installmentMonths:3,installmentPosition:0},t=_({...n});X(()=>r.transaction,e=>{e!=null&&e.id?t.value={...e,time:S(e.time)}:e!=null&&e.isFavorite?(delete e.isFavorite,t.value={...e,time:S(new Date)}):t.value={...n}},{immediate:!0});const o=async e=>{var i;e.preventDefault(),t.value.time=S(t.value.time);const a=JSON.parse(JSON.stringify(t.value));a.id||delete a.id;const s=await G(a);s.success?((i=document.querySelector("#transaction-form-modal"))==null||i.close(),b("close")):console.error(s.error)};return(e,a)=>(u(),V(T,{id:"transaction-form-modal",modalTitle:`${t.value.id?"Edit":"Add"} Transaction`,isForm:"",submit:o},{default:M(()=>[g(O,{label:"Amount",modelValue:t.value.amount,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.amount=s),type:"number",step:"0.01",placeholder:"0.00",required:""},null,8,["modelValue"]),t.value.id&&t.value.isInstallment?(u(),y("div",ce,[g(x(j),{size:"16"}),a[7]||(a[7]=l("span",null,[I("You are editing an installment transaction. Changing the "),l("strong",null,"Time"),I(" will set this is the starting of installment (1st month).")],-1))])):$("",!0),g(O,{label:"Time",modelValue:t.value.time,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.time=s),type:"datetime-local",required:""},null,8,["modelValue"]),t.value.isCCPay?$("",!0):(u(),V(z,{key:1,label:"Category",modelValue:t.value.categoryId,"onUpdate:modelValue":a[2]||(a[2]=s=>t.value.categoryId=s),options:m.value,required:""},null,8,["modelValue","options"])),g(z,{label:"Account",modelValue:t.value.accountId,"onUpdate:modelValue":a[3]||(a[3]=s=>t.value.accountId=s),options:d.value,required:""},null,8,["modelValue","options"]),g(O,{label:"Label",modelValue:t.value.label,"onUpdate:modelValue":a[4]||(a[4]=s=>t.value.label=s),placeholder:"Label / Comment",required:""},null,8,["modelValue"]),t.value.isCCPay?$("",!0):(u(),y("div",de,[g(ue,{label:"This transaction is installment",modelValue:t.value.isInstallment,"onUpdate:modelValue":a[5]||(a[5]=s=>t.value.isInstallment=s),disabled:!!t.value.id},null,8,["modelValue","disabled"])])),t.value.isInstallment?(u(),y(P,{key:3},[l("div",me,[g(x(j),{size:"16"}),a[8]||(a[8]=l("span",null,[I("For installment, please indicate the monthly payment in the "),l("strong",{class:"text-secondary"},'"Amount"'),I(" field above as this is the one will be copied for the succeeding months.")],-1))]),g(O,{label:"Installment Months",modelValue:t.value.installmentMonths,"onUpdate:modelValue":a[6]||(a[6]=s=>t.value.installmentMonths=s),type:"number",min:"1",placeholder:"3",required:""},null,8,["modelValue"]),l("p",ye,[a[9]||(a[9]=l("strong",{class:"text-primary"},"Computation: ",-1)),I(" "+p(x(w)(t.value.amount)+" x "+(t.value.installmentMonths||1)+" months = ")+" ",1),l("strong",null,p(x(w)((t.value.amount||0)*(t.value.installmentMonths||1))),1)])],64)):$("",!0)]),_:1},8,["modalTitle"]))}},ve={class:"mt-4 p-2 rounded-lg border-1 border-primary bg-primary/10"},ge={key:0,class:"text-center font-bold text-lg"},be={class:"text-center font-bold text-lg text-primary"},fe={key:0,class:"opacity-50"},he={key:1,class:"text-center text-xs"},xe={key:0,class:"mt-4 space-y-2"},$e={__name:"DeleteForm",props:{transaction:{type:Object,default:null}},emits:["close"],setup(c,{emit:h}){const r=c,b=h,m=async(d=!1)=>{var t;const n=await H(r.transaction.id,d);n.success?((t=document.querySelector("#delete-transaction-modal"))==null||t.close(),b("close")):console.error(n.error)};return(d,n)=>{var t,o;return u(),V(T,{id:"delete-transaction-modal",modalTitle:"Delete Transaction",isDanger:"",isForm:!((t=c.transaction)!=null&&t.isInstallment),submit:(o=c.transaction)!=null&&o.isInstallment?null:m,formButtonLabel:"Confirm",closeLabel:"Cancel"},{default:M(()=>{var e,a,s,i,v,k,L,q,A;return[n[2]||(n[2]=l("p",{class:"text-center text-balance"},"Are you sure you want to delete this transaction?",-1)),l("div",ve,[(e=c.transaction)!=null&&e.label?(u(),y("p",ge,p((a=c.transaction)==null?void 0:a.label),1)):$("",!0),l("p",be,[I(p(x(w)((s=c.transaction)==null?void 0:s.amount))+" ",1),(i=c.transaction)!=null&&i.isInstallment?(u(),y("small",fe,"per month")):$("",!0)]),(v=c.transaction)!=null&&v.isInstallment?(u(),y("p",he,p(((k=c.transaction)==null?void 0:k.installmentPosition)+"/"+((L=c.transaction)==null?void 0:L.installmentMonths))+" month"+p(((q=c.transaction)==null?void 0:q.installmentMonths)>1?"s":""),1)):$("",!0)]),(A=c.transaction)!=null&&A.isInstallment?(u(),y("div",xe,[l("button",{class:"text-error font-bold text-center w-full block",onClick:n[0]||(n[0]=f=>m(!0))}," Delete All Installments "),l("button",{class:"text-error font-bold text-center w-full block",onClick:n[1]||(n[1]=f=>m(!1))}," Delete This (and Future) Only ")])):$("",!0)]}),_:1},8,["isForm","submit"])}}},Ce={key:0,class:"flex justify-center items-center h-32 py-64"},ke={key:1,class:"text-center py-48"},_e={class:"p-4 pb-2 tracking-wide"},Ie={class:"badge badge-secondary badge-sm text-white"},we=["onClick"],Fe={key:0,class:"text-warning inline-block ml-1"},Ve={class:"text-xs font-semibold opacity-80"},Se={class:"my-1"},De={key:0,class:"inline-block ml-1 opacity-70"},Me=["onClick"],Le=["onClick"],qe={__name:"List",props:["transactions","isLoading","categories","accounts"],emits:["edit","delete","fetchData","favorite"],setup(c){const h=c,r=d=>{var n;return d?(n=h.accounts)==null?void 0:n.find(t=>t.id===d):null},b=d=>{var n;return d?(n=h.categories)==null?void 0:n.find(t=>t.id===d):null},m=F(()=>{const d={};return h.transactions.forEach(n=>{const t=S(n.time).split("T")[0];d[t]||(d[t]=[]),n.account=r(n.accountId),n.category=b(n.categoryId),d[t].push(n)}),d});return(d,n)=>(u(),y("div",null,[c.isLoading?(u(),y("div",Ce,n[0]||(n[0]=[l("span",{class:"loading loading-spinner loading-xl loading-primary"},null,-1)]))):Object.keys(m.value).length===0?(u(),y("div",ke,[g(x(le),{size:"124",class:"inline-block text-gray-300"}),n[1]||(n[1]=l("p",{class:"text-gray-300 text-lg mt-2"},"No transactions this month",-1))])):(u(!0),y(P,{key:2},U(m.value,(t,o)=>(u(),y("ul",{class:"list bg-base-100 rounded-box shadow-md mb-6",key:o},[l("li",_e,[l("span",Ie,p(new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1)]),(u(!0),y(P,null,U(t,e=>{var a,s,i,v;return u(),y("li",{class:D(["list-row flex justify-between items-center gap-0",{"bg-green-50":e.isCCPay}]),key:e.id},[l("div",{onClick:k=>d.$emit("edit",e),class:"w-full"},[l("div",null,[l("span",{class:D(["font-bold",{"text-red-500":((a=e.category)==null?void 0:a.type)=="Expense","text-green-500":((s=e.category)==null?void 0:s.type)=="Income"}])},p(x(w)(e.amount)),3),e.isInstallment?(u(),y("span",Fe,"("+p(e.installmentPosition+"/"+e.installmentMonths)+" month"+p(e.installmentMonths>1?"s":"")+")",1)):$("",!0)]),l("div",Ve,[l("p",Se,p(e.label),1),l("span",{class:D({"text-secondary":((i=e.account)==null?void 0:i.type)=="Debit","text-warning":((v=e.account)==null?void 0:v.type)=="Credit","text-error":!e.account})},p(e.account?e.account.name:"Out Source"),3),e.category?(u(),y("span",De,p(e.category.name),1)):$("",!0)])],8,we),!e.isInstallment&&!e.isCCPay?(u(),y("button",{key:0,class:"btn btn-square btn-sm btn-ghost text-warning",onClick:k=>d.$emit("favorite",e)},[g(x(E),{size:"16"})],8,Me)):$("",!0),l("button",{class:"btn btn-square btn-sm btn-ghost text-error",onClick:k=>d.$emit("delete",e)},[g(x(se),{size:"16"})],8,Le)],2)}),128))]))),128))]))}},Ae={class:"py-4"},Oe={class:"table"},Pe={__name:"Favorite",props:{transaction:{type:Object,default:null},accounts:{type:Array,default:[]},categories:{type:Array,default:[]}},emits:["close"],setup(c,{emit:h}){const r=c,b=h,m=F(()=>{var t,o;return(t=r.transaction)!=null&&t.accountId?(o=r.accounts)==null?void 0:o.find(e=>e.id===r.transaction.accountId):null}),d=F(()=>{var t,o;return(t=r.transaction)!=null&&t.categoryId?(o=r.categories)==null?void 0:o.find(e=>e.id===r.transaction.categoryId):null}),n=async()=>{var e,a,s,i,v;const t={label:(e=r.transaction)==null?void 0:e.label,amount:(a=r.transaction)==null?void 0:a.amount,categoryId:(s=r.transaction)==null?void 0:s.categoryId,accountId:(i=r.transaction)==null?void 0:i.accountId},o=await K("favorites",t);o.success?((v=document.querySelector("#transaction-favorite-modal"))==null||v.close(),b("close")):console.error("Failed to save favorite:",o.error)};return(t,o)=>(u(),V(T,{id:"transaction-favorite-modal",isForm:"",submit:n,closeLabel:"Cancel",modalTitle:"Save Template"},{default:M(()=>{var e,a;return[l("div",Ae,[l("table",Oe,[l("tbody",null,[l("tr",null,[o[0]||(o[0]=l("th",{class:"text-left text-primary p-0"},"Label",-1)),o[1]||(o[1]=l("td",{class:"p-0"},":",-1)),l("td",null,p((e=c.transaction)==null?void 0:e.label),1)]),l("tr",null,[o[2]||(o[2]=l("th",{class:"text-left text-primary p-0"},"Amount",-1)),o[3]||(o[3]=l("td",{class:"p-0"},":",-1)),l("td",null,p(x(w)((a=c.transaction)==null?void 0:a.amount)),1)]),l("tr",null,[o[4]||(o[4]=l("th",{class:"text-left text-primary p-0"},"Category",-1)),o[5]||(o[5]=l("td",{class:"p-0"},":",-1)),l("td",null,p(d.value?`${d.value.name} (${d.value.type})`:"--"),1)]),l("tr",null,[o[6]||(o[6]=l("th",{class:"text-left text-primary p-0"},"Account",-1)),o[7]||(o[7]=l("td",{class:"p-0"},":",-1)),l("td",null,p(m.value?`${m.value.name} (${m.value.type})`:"Out Source"),1)])])])])]}),_:1}))}},Te={class:"list bg-base-100 rounded-box border-1 border-gray-200 mb-6 mt-1"},Ne=["onClick"],Ue={class:"flex gap-4 w-full"},je={class:"flex gap-2 items-center mt-1"},ze={class:"text-xs font-semibold"},Ee={key:1,class:"opacity-50"},Be={key:0},We={__name:"SelectFavorite",props:{favorites:{type:Array,default:[]},accounts:{type:Array,default:[]},categories:{type:Array,default:[]}},emits:["useFavorite"],setup(c,{emit:h}){const r=c,b=h,m=o=>{var e;return o?(e=r.accounts)==null?void 0:e.find(a=>a.id===o):null},d=o=>{var e;return o?(e=r.categories)==null?void 0:e.find(a=>a.id===o):null},n=F(()=>{const o=[];return r.favorites.forEach(e=>{e.account=m(e.accountId),e.category=d(e.categoryId),o.push(e)}),o.sort((e,a)=>{var s,i,v,k;return((s=e.category)==null?void 0:s.type)===((i=a.category)==null?void 0:i.type)?e.label.localeCompare(a.label):(((v=e.category)==null?void 0:v.type)||"").localeCompare(((k=a.category)==null?void 0:k.type)||"")})}),t=o=>{var e;b("useFavorite",o),(e=document.querySelector("#select-favorite-modal"))==null||e.close()};return(o,e)=>(u(),V(T,{id:"select-favorite-modal",modalTitle:"Select Template",closeLabel:"Cancel"},{default:M(()=>{var a;return[l("ul",Te,[(u(!0),y(P,null,U(n.value,s=>(u(),y("li",{class:"list-row flex justify-between hover:bg-base-300 select-none",key:s.id,onClick:i=>t(s)},[l("div",Ue,[l("div",null,[l("div",null,[I(p(s.label)+" ",1),s.category?(u(),y("span",{key:0,class:D(["text-white",{"badge badge-sm badge-primary":s.category.type==="Income","badge badge-sm badge-error":s.category.type==="Expense"}])},p(`${s.category.name} (${s.category.type})`),3)):$("",!0)]),l("div",je,[l("div",ze,[I(p(s.amount)+" ",1),s.account?(u(),y("span",{key:0,class:D({"text-warning":s.account.type==="Credit","text-secondary":s.account.type==="Debit"})},p(`${s.account.name} (${s.account.type})`),3)):(u(),y("span",Ee,"Out Source"))])])])])],8,Ne))),128)),(a=n.value)!=null&&a.length?$("",!0):(u(),y("li",Be,e[0]||(e[0]=[l("div",{class:"p-2"},[l("div",{class:"alert alert-warning alert-soft"},[l("span",null,"No favorites available")])],-1)])))])]}),_:1}))}},Ye={class:"flex justify-center gap-4 items-center mb-4"},Je={class:"text-lg font-bold"},et={__name:"TransactionsView",setup(c){const h=_([]),r=_([]),b=_([]),m=_(null),d=_([]),n=_(new Date().getMonth()),t=_(new Date().getFullYear()),o=_(!1),e=async(f=!1)=>{o.value=!0,h.value=await ee(t.value,n.value),f&&(r.value=await N("categories"),b.value=await N("accounts")),o.value=!1},a=async()=>{d.value=await N("favorites")},s=(f=null)=>{var C;m.value=f,(C=document.querySelector("#transaction-form-modal"))==null||C.showModal()},i=f=>{var C;m.value=f,(C=document.querySelector("#delete-transaction-modal"))==null||C.showModal()},v=f=>{var C;m.value=f,(C=document.querySelector("#transaction-favorite-modal"))==null||C.showModal()},k=()=>{var f;(f=document.querySelector("#select-favorite-modal"))==null||f.showModal()},L=f=>{var C;m.value={label:f.label,amount:f.amount,categoryId:f.categoryId,accountId:f.accountId,time:new Date().toISOString(),isFavorite:!0},(C=document.querySelector("#transaction-form-modal"))==null||C.showModal()},q=()=>{n.value===0?(n.value=11,t.value-=1):n.value-=1,e()},A=()=>{n.value===11?(n.value=0,t.value+=1):n.value+=1,e()};return Q(()=>{e(!0),a()}),(f,C)=>(u(),V(Z,{pageTitle:"Transactions",bg:"bg-gray-100"},{default:M(()=>[l("div",Ye,[l("button",{class:"btn btn-xs btn-circle btn-soft btn-primary",onClick:q},[g(x(te))]),l("h2",Je,p(new Date(t.value,n.value).toLocaleString("default",{month:"long",year:"numeric"})),1),l("button",{class:"btn btn-xs btn-circle btn-soft btn-primary",onClick:A},[g(x(ae))])]),g(qe,{transactions:h.value,isLoading:o.value,categories:r.value,accounts:b.value,onEdit:s,onDelete:i,onFavorite:v},null,8,["transactions","isLoading","categories","accounts"]),g(oe,{icon:x(ne),onClick:s},null,8,["icon"]),l("button",{class:"btn btn-circle btn-secondary fixed bottom-26 shadow-secondary/50 shadow-md right-24 btn-sm",onClick:k},[g(x(E),{size:20,strokeWidth:"2"})]),g(pe,{transaction:m.value,onClose:e,categories:r.value,accounts:b.value},null,8,["transaction","categories","accounts"]),g($e,{transaction:m.value,onClose:e},null,8,["transaction"]),g(Pe,{transaction:m.value,categories:r.value,accounts:b.value,onClose:a},null,8,["transaction","categories","accounts"]),g(We,{favorites:d.value,accounts:b.value,categories:r.value,onUseFavorite:L},null,8,["favorites","accounts","categories"])]),_:1}))}};export{et as default};
