import{r as k,z as U,g as F,k as $,o as v,b as e,e as C,u as D,C as Y,t as r,j as q,F as R,l as A,n as S,m as V,p as L,i as I,G as O,f as E,a as T,w as z,d as B,A as J,H as W,_ as G,J as H}from"./index-C34JLIwx.js";import{g as N}from"./useIconGetter-BffgHyQ9.js";import{W as K,f as Q}from"./dateUtils-7C3-rwdx.js";import{_ as X}from"./Modal-BU7d6uVz.js";import{_ as M}from"./TextField-C9Z7Pkn8.js";import{_ as Z}from"./SelectField-CuppK2vP.js";const ee={class:"flex gap-2 justify-between items-center mb-8"},te={class:"text-center"},ae={class:"text-xs font-bold"},ne={key:0,class:"flex justify-center items-center h-32"},le={key:1,class:"text-center text-gray-500 mt-18"},oe={class:"text-center"},se={key:2,class:"list bg-base-100 rounded-box shadow-md dark:bg-gray-800"},ce={class:"flex gap-2 justify-between items-center w-full"},ue={class:"font-bold"},re={key:0,class:"text-warning inline-block ml-1"},ie={class:"items-end flex flex-col justify-center"},de={class:"text-xs text-blue-500"},me={class:"text-xs text-orange-500"},ge={__name:"Transactions",props:["account"],setup(o){const h=o,a=k([]),d=k(!0),x=k(null),f=k(null),c=k([]),w=(n,l=0)=>{const t=new Date;let m,s;if(n.type==="Credit"){const u=n.statementDay||1,b=new Date(t.getFullYear(),t.getMonth()+l,u);t.getDate()>=u?(m=new Date(b.getFullYear(),b.getMonth(),u+1),s=new Date(b.getFullYear(),b.getMonth()+1,u)):(m=new Date(b.getFullYear(),b.getMonth()-1,u+1),s=new Date(b.getFullYear(),b.getMonth(),u))}else{const u=new Date(t.getFullYear(),t.getMonth()+l,1);m=new Date(u.getFullYear(),u.getMonth(),1),s=new Date(u.getFullYear(),u.getMonth()+1,0)}return{startDate:m,endDate:s}},_=async()=>{c.value=await I("categories")},g=async(n=0)=>{if(!h.account)return;d.value=!0;const{startDate:l,endDate:t}=w(h.account,n);x.value=l,f.value=t,a.value=await O(h.account.id,x.value,f.value),a.value=a.value.map(m=>{var u;const s=(u=c.value)==null?void 0:u.find(b=>b.id===m.categoryId);return{...m,category:s}}),d.value=!1};U(()=>h.account,()=>{g()},{immediate:!0}),F(()=>{_(),g()});const y=k(0),p=()=>{y.value-=1,g(y.value)},i=()=>{y.value+=1,g(y.value)};return(n,l)=>(v(),$("div",null,[e("div",ee,[e("button",{class:"btn btn-secondary btn-sm btn-soft btn-circle",onClick:p},[C(D(Y))]),e("div",te,[l[0]||(l[0]=e("h2",{class:"text-secondary font-bold text-lg"},"Transactions",-1)),e("p",ae,r(x.value?x.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"")+" - "+r(f.value?f.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""),1)]),e("button",{class:"btn btn-secondary btn-circle btn-soft btn-sm",onClick:i},[C(D(q))])]),d.value?(v(),$("div",ne,l[1]||(l[1]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):a.value.length===0?(v(),$("div",le,[e("div",oe,[C(D(K),{size:"82",class:"inline-block text-gray-300"})]),l[2]||(l[2]=e("p",{class:"text-balance max-w-10/12 m-auto"}," No transactions found for the current date range. ",-1))])):(v(),$("ul",se,[(v(!0),$(R,null,A(a.value,t=>{var m,s;return v(),$("li",{class:S(["list-row",{"bg-green-50 dark:bg-green-800/30":t.isCCPay}]),key:t.id},[e("div",ce,[e("div",null,[e("p",ue,[e("span",{class:S({"text-green-500":((m=t.category)==null?void 0:m.type)=="Income","text-red-500":((s=t.category)==null?void 0:s.type)=="Expense"})},r(D(L)(t.amount)),3),t.isInstallment?(v(),$("span",re,"("+r(t.installmentPosition+"/"+t.installmentMonths)+" month"+r(t.installmentMonths>1?"s":"")+")",1)):V("",!0)]),e("p",{class:S(["text-xs",{"text-green-500 font-bold":t.isCCPay}])},r(t.label),3)])]),e("div",ie,[e("p",de,r(new Date(t.time).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1),e("p",me,r(t.category?`${t.category.name} (${t.category.type})`:""),1)])],2)}),128))]))]))}},ye={class:"mb-4"},be={class:"font-bold text-orange-500"},fe={class:"text-red-700"},ve={class:"text-red-700 text-xs"},he={__name:"Pay",props:{account:{type:Object,default:null}},emits:["refresh"],setup(o,{emit:h}){var g,y,p;const a=o,d=k([]),x=async()=>{d.value=await I("accounts")};F(()=>{x()});const f=h,c=k({time:Q(new Date),amount:((g=a.account)==null?void 0:g.balance)||0,accountId:"",label:`Pay ${(y=a.account)==null?void 0:y.name}`,categoryId:null,isCCPay:!0,ccId:(p=a.account)==null?void 0:p.id,isInstallment:!1,installmentId:null,installmentMonths:0,installmentPosition:1});U(()=>a.account,i=>{i&&(c.value.amount=i.balance||0,c.value.ccId=i.id||null,c.value.label=`Pay ${i.name}`)});const w=E(()=>{var i,n;return[{label:"Out Source / Cash",value:""},...(n=(i=d.value)==null?void 0:i.filter(l=>{var t;return l.id!=((t=a.account)==null?void 0:t.id)}))==null?void 0:n.map(l=>({label:l.name+" / "+l.type+" ( "+L(l.type=="Debit"?l.amount:l.creditLimit-l.balance)+")",value:l.id}))]}),_=async()=>{var l;if(!c.value.amount||c.value.amount<=0){alert("Please enter a valid amount.");return}const i=JSON.parse(JSON.stringify(c.value)),n=await J(i);n.success?((l=document.querySelector("#accounts-pay-modal"))==null||l.close(),f("refresh")):console.error("Failed to save payment:",n.error)};return(i,n)=>(v(),T(X,{id:"accounts-pay-modal",modalTitle:"Pay Balance",isForm:"",submit:_,formButtonLabel:"Pay",closeLabel:"Cancel"},{default:z(()=>{var l,t,m;return[e("div",ye,[e("p",be,r((l=o.account)==null?void 0:l.name),1),e("p",fe,[n[4]||(n[4]=e("strong",null,"Balance:",-1)),B(" "+r(D(L)((t=o.account)==null?void 0:t.balance)),1)]),e("p",ve,[n[5]||(n[5]=e("strong",null,"Due Date:",-1)),B(" "+r((()=>{var u;const s=new Date;return s.setDate(((u=o.account)==null?void 0:u.statementDay)||1),s.setDate(s.getDate()+20),s.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)])]),C(M,{modelValue:c.value.label,"onUpdate:modelValue":n[0]||(n[0]=s=>c.value.label=s),label:"Label",placeholder:"Payment Label",required:""},null,8,["modelValue"]),C(M,{modelValue:c.value.time,"onUpdate:modelValue":n[1]||(n[1]=s=>c.value.time=s),label:"Payment Time",type:"datetime-local",required:""},null,8,["modelValue"]),C(M,{modelValue:c.value.amount,"onUpdate:modelValue":n[2]||(n[2]=s=>c.value.amount=s),modelModifiers:{number:!0},label:"Amount to Pay",type:"number",max:((m=o.account)==null?void 0:m.balance)||0,required:"",min:"1"},null,8,["modelValue","max"]),C(Z,{modelValue:c.value.accountId,"onUpdate:modelValue":n[3]||(n[3]=s=>c.value.accountId=s),options:w.value,label:"Account to Pay",required:""},null,8,["modelValue","options"])]}),_:1}))}},xe={class:"text-2xl text-primary dark:text-teal-400 font-black"},pe=["value"],De={class:"font-bold"},we={class:"font-bold text-red-500 dark:text-red-400"},_e={class:"flex justify-between bg-orange-500/10 -mx-4 mt-2 px-4 py-2 -mb-10 rounded-b-xl"},$e={class:"text-lg font-bold"},ke={class:"text-right"},Ce={class:"text-lg font-bold"},Se={class:"text-center"},Le=["disabled"],Pe={__name:"AmountCard",props:{account:{type:Object,default:null}},emits:["refresh"],setup(o){const h=()=>{var a;(a=document.querySelector("#accounts-pay-modal"))==null||a.showModal()};return(a,d)=>{var x,f,c,w,_,g,y,p,i,n,l,t,m,s,u,b;return v(),$("div",{class:S(["bg-white dark:bg-gray-700 rounded-xl shadow-xl z-[2] relative -mt-10 p-4 mb-12",{"shadow-orange-500/20 dark:shadow-orange-700/10":((x=o.account)==null?void 0:x.type)==="Credit","shadow-secondary/20 dark:shadow-secondary/10":((f=o.account)==null?void 0:f.type)==="Debit"}])},[e("p",null,[e("small",null,r(((c=o.account)==null?void 0:c.type)=="Credit"?"Remaining Credits":"Balance"),1)]),e("p",xe,r(D(L)(((w=o.account)==null?void 0:w.type)=="Credit"?((_=o.account)==null?void 0:_.creditLimit)-((g=o.account)==null?void 0:g.balance):(y=o.account)==null?void 0:y.amount)),1),((p=o.account)==null?void 0:p.type)==="Credit"?(v(),$(R,{key:0},[e("progress",{class:"progress progress-primary dark:bg-teal-500/30 dark:text-teal-200 w-full",value:((i=o.account)==null?void 0:i.balance)/((n=o.account)==null?void 0:n.creditLimit)*100||0,max:"100"},null,8,pe),e("p",De,[e("small",null,"Statement Date: "+r(new Date(new Date().setDate(((l=o.account)==null?void 0:l.statementDay)||1)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1)]),e("p",we,[e("small",null,"Due Date: "+r((()=>{var j;const P=new Date;return P.setDate(((j=o.account)==null?void 0:j.statementDay)||1),P.setDate(P.getDate()+20),P.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)]),e("div",_e,[e("div",null,[d[1]||(d[1]=e("p",{class:"font-bold"},[e("small",null,"Credit Limit")],-1)),e("p",$e,r(D(L)((t=o.account)==null?void 0:t.creditLimit)),1)]),e("div",ke,[d[2]||(d[2]=e("p",{class:"font-bold"},[e("small",null,"Balance")],-1)),e("p",Ce,r(D(L)((m=o.account)==null?void 0:m.balance)),1)])]),e("div",Se,[e("button",{disabled:!((s=o.account)!=null&&s.balance),class:S(["btn btn-circle btn-primary bg-linear-to-t from-teal-800 to-teal-500 outline-2 outline-offset-2 outline-primary btn-md text-white font-bold shadow-xl -mb-16 -mt-4 shadow-primary/50",{"grayscale-100":!((u=o.account)!=null&&u.balance)}]),onClick:h}," Pay ",10,Le)])],64)):V("",!0),(b=o.account)!=null&&b.balance?(v(),T(he,{key:1,account:o.account,onRefresh:d[0]||(d[0]=P=>a.$emit("refresh"))},null,8,["account"])):V("",!0)],2)}}},Me={class:"relative -mx-5 -mt-2 p-5 min-h-48"},Ve={class:"relative z-[2] max-w-10/12 h-full"},Fe={class:"w-14 h-12 bg-white dark:bg-gray-800 px-2 py-1 mb-2 rounded-md"},Ie=["src","alt"],Te={class:"text-white text-xl font-black"},je={class:"w-6/12 h-10/12 absolute top-6/12 right-5 -translate-y-6/12 z-[0]"},Be=["src","alt"],Ne={class:"border-2 border-dashed bg-gray-200 border-gray-300 rounded-xl p-2 mb-8 dark:bg-gray-800"},Ue={class:"italic"},Ee=W({__name:"View",setup(o){const h=H(),a=k(null),d=async()=>{a.value=await I("accounts",h.params.id)};return F(()=>{d()}),(x,f)=>(v(),T(G,{pageTitle:(a.value?a.value.type:"")+" Account",isSubNav:"",bg:"bg-gray-100 dark:bg-gray-900"},{default:z(()=>{var c,w,_,g,y,p,i,n;return[e("div",Me,[e("div",Ve,[e("div",Fe,[e("img",{src:D(N)((c=a.value)==null?void 0:c.cardType),alt:(w=a.value)==null?void 0:w.cardType,class:"w-full h-full object-contain"},null,8,Ie)]),e("h2",Te,r(((_=a.value)==null?void 0:_.name)||"Account"),1)]),e("div",{class:S(["w-full h-full bg-linear-to-r absolute top-0 left-0 z-[1]",{"from-secondary to-secondary/50":((g=a.value)==null?void 0:g.type)==="Debit","from-warning to-warning/50":((y=a.value)==null?void 0:y.type)==="Credit","from-gray-500 to-gray-500/50":!a.value}])},null,2),e("div",je,[e("img",{src:D(N)((p=a.value)==null?void 0:p.bank),alt:(i=a.value)==null?void 0:i.bank,class:"w-full h-full object-contain"},null,8,Be)])]),C(Pe,{account:a.value,onRefresh:d},null,8,["account"]),e("div",Ne,[f[0]||(f[0]=e("p",{class:"font-bold text-xs"},"Note:",-1)),e("p",Ue,r(((n=a.value)==null?void 0:n.comment)||"--"),1)]),C(ge,{account:a.value},null,8,["account"])]}),_:1},8,["pageTitle"]))}});export{Ee as default};
