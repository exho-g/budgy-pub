import{r as C,y as U,e as F,j as $,o as v,a as e,h as k,u as D,C as Y,t as i,i as q,F as R,k as O,n as S,l as V,m as L,f as I,E as A,d as E,c as T,w as z,b as B,z as J,G as W,_ as G,H}from"./index-he4iJ0d7.js";import{g as N}from"./useIconGetter-D6D8pCoh.js";import{W as K,f as Q}from"./dateUtils-D-YbvD5G.js";import{_ as X}from"./Modal-e3EZez0h.js";import{_ as M}from"./TextField-DqFvf-7n.js";import{_ as Z}from"./SelectField-CFYXrSBm.js";const ee={class:"flex gap-2 justify-between items-center mb-8"},te={class:"text-center"},ae={class:"text-xs font-bold"},ne={key:0,class:"flex justify-center items-center h-32"},le={key:1,class:"text-center text-gray-500 mt-18"},oe={class:"text-center"},se={key:2,class:"list bg-base-100 rounded-box shadow-md"},ce={class:"flex gap-2 justify-between items-center w-full"},ue={class:"font-bold"},ie={key:0,class:"text-warning inline-block ml-1"},re={class:"items-end flex flex-col justify-center"},de={class:"text-xs text-blue-500"},me={class:"text-xs text-orange-500"},ye={__name:"Transactions",props:["account"],setup(o){const h=o,a=C([]),d=C(!0),x=C(null),f=C(null),c=C([]),w=(n,l=0)=>{const t=new Date;let m,s;if(n.type==="Credit"){const u=n.statementDay||1,b=new Date(t.getFullYear(),t.getMonth()+l,u);t.getDate()>=u?(m=new Date(b.getFullYear(),b.getMonth(),u+1),s=new Date(b.getFullYear(),b.getMonth()+1,u)):(m=new Date(b.getFullYear(),b.getMonth()-1,u+1),s=new Date(b.getFullYear(),b.getMonth(),u))}else{const u=new Date(t.getFullYear(),t.getMonth()+l,1);m=new Date(u.getFullYear(),u.getMonth(),1),s=new Date(u.getFullYear(),u.getMonth()+1,0)}return{startDate:m,endDate:s}},_=async()=>{c.value=await I("categories")},y=async(n=0)=>{if(!h.account)return;d.value=!0;const{startDate:l,endDate:t}=w(h.account,n);x.value=l,f.value=t,a.value=await A(h.account.id,x.value,f.value),a.value=a.value.map(m=>{var u;const s=(u=c.value)==null?void 0:u.find(b=>b.id===m.categoryId);return{...m,category:s}}),d.value=!1};U(()=>h.account,()=>{y()},{immediate:!0}),F(()=>{_(),y()});const g=C(0),p=()=>{g.value-=1,y(g.value)},r=()=>{g.value+=1,y(g.value)};return(n,l)=>(v(),$("div",null,[e("div",ee,[e("button",{class:"btn btn-secondary btn-sm btn-soft btn-circle",onClick:p},[k(D(Y))]),e("div",te,[l[0]||(l[0]=e("h2",{class:"text-secondary font-bold text-lg"},"Transactions",-1)),e("p",ae,i(x.value?x.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"")+" - "+i(f.value?f.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""),1)]),e("button",{class:"btn btn-secondary btn-circle btn-soft btn-sm",onClick:r},[k(D(q))])]),d.value?(v(),$("div",ne,l[1]||(l[1]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):a.value.length===0?(v(),$("div",le,[e("div",oe,[k(D(K),{size:"82",class:"inline-block text-gray-300"})]),l[2]||(l[2]=e("p",{class:"text-balance max-w-10/12 m-auto"}," No transactions found for the current date range. ",-1))])):(v(),$("ul",se,[(v(!0),$(R,null,O(a.value,t=>{var m,s;return v(),$("li",{class:S(["list-row",{"bg-green-50":t.isCCPay}]),key:t.id},[e("div",ce,[e("div",null,[e("p",ue,[e("span",{class:S({"text-green-500":((m=t.category)==null?void 0:m.type)=="Income","text-red-500":((s=t.category)==null?void 0:s.type)=="Expense"})},i(D(L)(t.amount)),3),t.isInstallment?(v(),$("span",ie,"("+i(t.installmentPosition+"/"+t.installmentMonths)+" month"+i(t.installmentMonths>1?"s":"")+")",1)):V("",!0)]),e("p",{class:S(["text-xs",{"text-green-500 font-bold":t.isCCPay}])},i(t.label),3)])]),e("div",re,[e("p",de,i(new Date(t.time).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1),e("p",me,i(t.category?`${t.category.name} (${t.category.type})`:""),1)])],2)}),128))]))]))}},ge={class:"mb-4"},be={class:"font-bold text-orange-500"},fe={class:"text-red-700"},ve={class:"text-red-700 text-xs"},he={__name:"Pay",props:{account:{type:Object,default:null}},emits:["refresh"],setup(o,{emit:h}){var y,g,p;const a=o,d=C([]),x=async()=>{d.value=await I("accounts")};F(()=>{x()});const f=h,c=C({time:Q(new Date),amount:((y=a.account)==null?void 0:y.balance)||0,accountId:"",label:`Pay ${(g=a.account)==null?void 0:g.name}`,categoryId:null,isCCPay:!0,ccId:(p=a.account)==null?void 0:p.id,isInstallment:!1,installmentId:null,installmentMonths:0,installmentPosition:1});U(()=>a.account,r=>{r&&(c.value.amount=r.balance||0,c.value.ccId=r.id||null,c.value.label=`Pay ${r.name}`)});const w=E(()=>{var r,n;return[{label:"Out Source / Cash",value:""},...(n=(r=d.value)==null?void 0:r.filter(l=>{var t;return l.id!=((t=a.account)==null?void 0:t.id)}))==null?void 0:n.map(l=>({label:l.name+" / "+l.type+" ( "+L(l.type=="Debit"?l.amount:l.creditLimit-l.balance)+")",value:l.id}))]}),_=async()=>{var l;if(!c.value.amount||c.value.amount<=0){alert("Please enter a valid amount.");return}const r=JSON.parse(JSON.stringify(c.value)),n=await J(r);n.success?((l=document.querySelector("#accounts-pay-modal"))==null||l.close(),f("refresh")):console.error("Failed to save payment:",n.error)};return(r,n)=>(v(),T(X,{id:"accounts-pay-modal",modalTitle:"Pay Balance",isForm:"",submit:_,formButtonLabel:"Pay",closeLabel:"Cancel"},{default:z(()=>{var l,t,m;return[e("div",ge,[e("p",be,i((l=o.account)==null?void 0:l.name),1),e("p",fe,[n[4]||(n[4]=e("strong",null,"Balance:",-1)),B(" "+i(D(L)((t=o.account)==null?void 0:t.balance)),1)]),e("p",ve,[n[5]||(n[5]=e("strong",null,"Due Date:",-1)),B(" "+i((()=>{var u;const s=new Date;return s.setDate(((u=o.account)==null?void 0:u.statementDay)||1),s.setDate(s.getDate()+20),s.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)])]),k(M,{modelValue:c.value.label,"onUpdate:modelValue":n[0]||(n[0]=s=>c.value.label=s),label:"Label",placeholder:"Payment Label",required:""},null,8,["modelValue"]),k(M,{modelValue:c.value.time,"onUpdate:modelValue":n[1]||(n[1]=s=>c.value.time=s),label:"Payment Time",type:"datetime-local",required:""},null,8,["modelValue"]),k(M,{modelValue:c.value.amount,"onUpdate:modelValue":n[2]||(n[2]=s=>c.value.amount=s),modelModifiers:{number:!0},label:"Amount to Pay",type:"number",max:((m=o.account)==null?void 0:m.balance)||0,required:"",min:"1"},null,8,["modelValue","max"]),k(Z,{modelValue:c.value.accountId,"onUpdate:modelValue":n[3]||(n[3]=s=>c.value.accountId=s),options:w.value,label:"Account to Pay",required:""},null,8,["modelValue","options"])]}),_:1}))}},xe={class:"text-2xl text-primary font-black"},pe=["value"],De={class:"font-bold"},we={class:"font-bold text-red-500"},_e={class:"flex justify-between bg-orange-500/10 -mx-4 mt-2 px-4 py-2 -mb-10 rounded-b-xl"},$e={class:"text-lg font-bold"},Ce={class:"text-right"},ke={class:"text-lg font-bold"},Se={class:"text-center"},Le=["disabled"],Pe={__name:"AmountCard",props:{account:{type:Object,default:null}},emits:["refresh"],setup(o){const h=()=>{var a;(a=document.querySelector("#accounts-pay-modal"))==null||a.showModal()};return(a,d)=>{var x,f,c,w,_,y,g,p,r,n,l,t,m,s,u,b;return v(),$("div",{class:S(["bg-white rounded-xl shadow-xl z-[2] relative -mt-10 p-4 mb-12",{"shadow-orange-500/20":((x=o.account)==null?void 0:x.type)==="Credit","shadow-secondary/20":((f=o.account)==null?void 0:f.type)==="Debit"}])},[e("p",null,[e("small",null,i(((c=o.account)==null?void 0:c.type)=="Credit"?"Remaining Credits":"Balance"),1)]),e("p",xe,i(D(L)(((w=o.account)==null?void 0:w.type)=="Credit"?((_=o.account)==null?void 0:_.creditLimit)-((y=o.account)==null?void 0:y.balance):(g=o.account)==null?void 0:g.amount)),1),((p=o.account)==null?void 0:p.type)==="Credit"?(v(),$(R,{key:0},[e("progress",{class:"progress progress-primary w-full",value:((r=o.account)==null?void 0:r.balance)/((n=o.account)==null?void 0:n.creditLimit)*100||0,max:"100"},null,8,pe),e("p",De,[e("small",null,"Statement Date: "+i(new Date(new Date().setDate(((l=o.account)==null?void 0:l.statementDay)||1)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1)]),e("p",we,[e("small",null,"Due Date: "+i((()=>{var j;const P=new Date;return P.setDate(((j=o.account)==null?void 0:j.statementDay)||1),P.setDate(P.getDate()+20),P.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)]),e("div",_e,[e("div",null,[d[1]||(d[1]=e("p",{class:"font-bold"},[e("small",null,"Credit Limit")],-1)),e("p",$e,i(D(L)((t=o.account)==null?void 0:t.creditLimit)),1)]),e("div",Ce,[d[2]||(d[2]=e("p",{class:"font-bold"},[e("small",null,"Balance")],-1)),e("p",ke,i(D(L)((m=o.account)==null?void 0:m.balance)),1)])]),e("div",Se,[e("button",{disabled:!((s=o.account)!=null&&s.balance),class:S(["btn btn-circle btn-primary bg-linear-to-t from-teal-800 to-teal-500 outline-2 outline-offset-2 outline-primary btn-md text-white font-bold shadow-xl -mb-16 -mt-4 shadow-primary/50",{"grayscale-100":!((u=o.account)!=null&&u.balance)}]),onClick:h}," Pay ",10,Le)])],64)):V("",!0),(b=o.account)!=null&&b.balance?(v(),T(he,{key:1,account:o.account,onRefresh:d[0]||(d[0]=P=>a.$emit("refresh"))},null,8,["account"])):V("",!0)],2)}}},Me={class:"relative -mx-5 -mt-2 p-5 min-h-48"},Ve={class:"relative z-[2] max-w-10/12 h-full"},Fe={class:"w-14 h-12 bg-white px-2 py-1 mb-2 rounded-md"},Ie=["src","alt"],Te={class:"text-white text-xl font-black"},je={class:"w-6/12 h-10/12 absolute top-6/12 right-5 -translate-y-6/12 z-[0]"},Be=["src","alt"],Ne={class:"border-2 border-dashed bg-gray-200 border-gray-300 rounded-xl p-2 mb-8"},Ue={class:"italic"},Ee=W({__name:"View",setup(o){const h=H(),a=C(null),d=async()=>{a.value=await I("accounts",h.params.id)};return F(()=>{d()}),(x,f)=>(v(),T(G,{pageTitle:(a.value?a.value.type:"")+" Account",isSubNav:"",bg:"bg-gray-100"},{default:z(()=>{var c,w,_,y,g,p,r,n;return[e("div",Me,[e("div",Ve,[e("div",Fe,[e("img",{src:D(N)((c=a.value)==null?void 0:c.cardType),alt:(w=a.value)==null?void 0:w.cardType,class:"w-full h-full object-contain"},null,8,Ie)]),e("h2",Te,i(((_=a.value)==null?void 0:_.name)||"Account"),1)]),e("div",{class:S(["w-full h-full bg-linear-to-r absolute top-0 left-0 z-[1]",{"from-secondary to-secondary/50":((y=a.value)==null?void 0:y.type)==="Debit","from-warning to-warning/50":((g=a.value)==null?void 0:g.type)==="Credit","from-gray-500 to-gray-500/50":!a.value}])},null,2),e("div",je,[e("img",{src:D(N)((p=a.value)==null?void 0:p.bank),alt:(r=a.value)==null?void 0:r.bank,class:"w-full h-full object-contain"},null,8,Be)])]),k(Pe,{account:a.value,onRefresh:d},null,8,["account"]),e("div",Ne,[f[0]||(f[0]=e("p",{class:"font-bold text-xs"},"Note:",-1)),e("p",Ue,i(((n=a.value)==null?void 0:n.comment)||"--"),1)]),k(ye,{account:a.value},null,8,["account"])]}),_:1},8,["pageTitle"]))}});export{Ee as default};
