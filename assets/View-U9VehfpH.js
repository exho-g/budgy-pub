import{r as _,z as Y,g as P,k as w,o as p,b as e,e as C,u as x,C as O,t as c,j as q,F as z,l as E,n as T,m as S,p as L,i as V,K as J,f as W,a as I,w as A,d as U,v as F,B as K,D as j,E as G,L as H,_ as Q,M as X}from"./index-CvJCmTcD.js";import{g as N}from"./useIconGetter-BffgHyQ9.js";import{W as Z,f as ee}from"./dateUtils-DLvv1uTU.js";import{_ as te}from"./Modal-CVwSb8le.js";import{_ as R}from"./TextField-CP-1NCxw.js";import{_ as ae}from"./SelectField-DRYfb3B_.js";import{T as ne}from"./triangle-alert-jCn6hu34.js";const le={class:"flex gap-2 justify-between items-center mb-8"},oe={class:"text-center"},se={class:"text-xs font-bold"},re={key:0,class:"flex justify-center items-center h-32"},ce={key:1,class:"text-center text-gray-500 mt-18"},ue={class:"text-center"},ie={key:2,class:"list bg-base-100 rounded-box shadow-md dark:bg-gray-800"},de={class:"flex gap-2 justify-between items-center w-full"},me={class:"font-bold"},be={key:0,class:"text-warning inline-block ml-1"},ye={class:"items-end flex flex-col justify-center"},ge={class:"text-xs text-blue-500"},pe={class:"text-xs text-orange-500"},fe={__name:"Transactions",props:["account"],setup(s){const h=s,l=_([]),d=_(!0),D=_(null),f=_(null),n=_([]),$=(o,r=0)=>{const t=new Date;let m,v;if(o.type==="Credit"){const i=o.statementDay||1,g=new Date(t.getFullYear(),t.getMonth()+r,i);t.getDate()>=i?(m=new Date(g.getFullYear(),g.getMonth(),i+1),v=new Date(g.getFullYear(),g.getMonth()+1,i)):(m=new Date(g.getFullYear(),g.getMonth()-1,i+1),v=new Date(g.getFullYear(),g.getMonth(),i))}else{const i=new Date(t.getFullYear(),t.getMonth()+r,1);m=new Date(i.getFullYear(),i.getMonth(),1),v=new Date(i.getFullYear(),i.getMonth()+1,0)}return{startDate:m,endDate:v}},k=async()=>{n.value=await V("categories")},b=async(o=0)=>{if(!h.account)return;d.value=!0;const{startDate:r,endDate:t}=$(h.account,o);D.value=r,f.value=t,l.value=await J(h.account.id,D.value,f.value),l.value=l.value.map(m=>{var i;const v=(i=n.value)==null?void 0:i.find(g=>g.id===m.categoryId);return{...m,category:v}}),d.value=!1};Y(()=>h.account,()=>{b()},{immediate:!0}),P(()=>{k(),b()});const y=_(0),u=()=>{y.value-=1,b(y.value)},a=()=>{y.value+=1,b(y.value)};return(o,r)=>(p(),w("div",null,[e("div",le,[e("button",{class:"btn btn-secondary btn-sm btn-soft btn-circle",onClick:u},[C(x(O))]),e("div",oe,[r[0]||(r[0]=e("h2",{class:"text-secondary font-bold text-lg"},"Transactions",-1)),e("p",se,c(D.value?D.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"")+" - "+c(f.value?f.value.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""),1)]),e("button",{class:"btn btn-secondary btn-circle btn-soft btn-sm",onClick:a},[C(x(q))])]),d.value?(p(),w("div",re,r[1]||(r[1]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):l.value.length===0?(p(),w("div",ce,[e("div",ue,[C(x(Z),{size:"82",class:"inline-block text-gray-300"})]),r[2]||(r[2]=e("p",{class:"text-balance max-w-10/12 m-auto"}," No transactions found for the current date range. ",-1))])):(p(),w("ul",ie,[(p(!0),w(z,null,E(l.value,t=>{var m,v;return p(),w("li",{class:T(["list-row",{"bg-green-50 dark:bg-green-800/30":t.isCCPay}]),key:t.id},[e("div",de,[e("div",null,[e("p",me,[e("span",{class:T({"text-green-500":((m=t.category)==null?void 0:m.type)=="Income","text-red-500":((v=t.category)==null?void 0:v.type)=="Expense"})},c(x(L)(t.amount)),3),t.isInstallment?(p(),w("span",be,"("+c(t.installmentPosition+"/"+t.installmentMonths)+" month"+c(t.installmentMonths>1?"s":"")+")",1)):S("",!0)]),e("p",{class:T(["text-xs",{"text-green-500 font-bold":t.isCCPay}])},c(t.label),3)])]),e("div",ye,[e("p",ge,c(new Date(t.time).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1),e("p",pe,c(t.category?`${t.category.name} (${t.category.type})`:""),1)])],2)}),128))]))]))}},ve={class:"mb-4 mt-4 bg-linear-to-r from-secondary/5 to-secondary/30 p-2 rounded-lg outline-2 outline-secondary outline-offset-4"},xe={class:"font-bold text-orange-500"},he={class:"flex justify-between items-center"},De={class:"text-red-700"},we={class:"text-red-700 py-1 px-2 rounded-md text-xs bg-red-500/20"},$e={class:"mt-4 mb-6"},ke={class:"text-center -mt-2"},_e={key:0,role:"alert",class:"alert alert-error alert-soft"},Ce={class:"grid grid-cols-2 text-center mb-4"},Te={__name:"Pay",props:{account:{type:Object,default:null}},emits:["refresh"],setup(s,{emit:h}){var b,y;const l=s,d=_([]),D=async()=>{d.value=await V("accounts")};P(()=>{D()});const f=h,n=_({time:ee(new Date),amount:0,cardType:"Debit",accountId:"",label:`Pay ${(b=l.account)==null?void 0:b.name}`,type:"Income",categoryId:null,isCCPay:!0,ccId:(y=l.account)==null?void 0:y.id,isInstallment:!1,installmentId:null,installmentMonths:0,installmentPosition:1});Y(()=>l.account,u=>{u&&(n.value.amount=parseFloat(u.balance).toFixed(2)||0,n.value.ccId=u.id||null,n.value.label=`Pay ${u.name}`)});const $=W(()=>{var u,a;return[{label:"Out Source / Cash",value:""},...(a=(u=d.value)==null?void 0:u.filter(o=>{var r;return o.id!=((r=l.account)==null?void 0:r.id)&&o.type===n.value.cardType}))==null?void 0:a.map(o=>({label:o.name+" / "+o.type+" "+L(o.type=="Debit"?o.amount:o.creditLimit-o.balance),value:o.id}))]}),k=async()=>{var o;if(!n.value.amount||n.value.amount<=0){alert("Please enter a valid amount.");return}const u=JSON.parse(JSON.stringify(n.value)),a=await G(u);a.success?((o=document.querySelector("#accounts-pay-modal"))==null||o.close(),f("refresh")):console.error("Failed to save payment:",a.error)};return(u,a)=>(p(),I(te,{id:"accounts-pay-modal",modalTitle:"Pay Balance",isForm:"",submit:k,formButtonLabel:"Pay",closeLabel:"Cancel"},{default:A(()=>{var o,r;return[e("div",ve,[e("p",xe,c((o=s.account)==null?void 0:o.name),1),e("div",he,[e("p",De,[a[7]||(a[7]=e("strong",null,"Balance:",-1)),U(" "+c(x(L)((r=s.account)==null?void 0:r.balance)),1)]),e("p",we,[a[8]||(a[8]=e("strong",null,"Due Date:",-1)),U(" "+c((()=>{var m;const t=new Date;return t.setDate(((m=s.account)==null?void 0:m.statementDay)||1),t.setDate(t.getDate()+20),t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)])])]),e("div",$e,[F(e("input",{id:"transaction-amount","onUpdate:modelValue":a[0]||(a[0]=t=>n.value.amount=t),type:"number",step:"0.01",placeholder:"0.00",required:"",class:"text-center w-full font-bold text-5xl outline-none",min:"0.01"},null,512),[[K,n.value.amount]]),a[9]||(a[9]=e("p",{class:"text-center -mt-3"},[e("label",{for:"transaction-amount",class:"font-bold inline-block text-secondary"},"Amount")],-1)),e("p",ke,[e("span",{class:"link text-orange-500 inline-block ml-1 text-xs",onClick:a[1]||(a[1]=()=>{var t;n.value.amount=parseFloat(((t=l.account)==null?void 0:t.balance)||0).toFixed(2)})},"(Tap here for Max Balance)")])]),n.value.amount>s.account.balance?(p(),w("div",_e,[C(x(ne)),a[10]||(a[10]=e("span",null,"You are about to pay more than your current account balance.",-1))])):S("",!0),C(R,{modelValue:n.value.time,"onUpdate:modelValue":a[2]||(a[2]=t=>n.value.time=t),label:"Payment Time",type:"datetime-local",required:""},null,8,["modelValue"]),a[13]||(a[13]=e("p",{class:"mt-8 mb-2 font-bold text-primary"},"Account to Pay",-1)),e("div",Ce,[e("label",{class:T(["cursor-pointer font-bold text-sm border-2 border-gray-500 rounded-xl rounded-r-none border-r-0 py-2",{"bg-linear-to-r from-gray-900 to-gray-600 text-white":n.value.cardType==="Credit","bg-transparent text-gray-500":n.value.cardType!=="Credit"}])},[a[11]||(a[11]=e("span",{class:"block"},"Credit",-1)),F(e("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=t=>n.value.cardType=t),value:"Credit",class:"hidden"},null,512),[[j,n.value.cardType]])],2),e("label",{class:T(["cursor-pointer font-bold text-sm border-2 border-gray-500 rounded-xl rounded-l-none border-l-0 py-2",{"bg-linear-to-l from-gray-900 to-gray-600 text-white":n.value.cardType==="Debit","bg-transparent text-gray-500":n.value.cardType!=="Debit"}])},[a[12]||(a[12]=e("span",{class:"block"},"Debit",-1)),F(e("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=t=>n.value.cardType=t),value:"Debit",class:"hidden"},null,512),[[j,n.value.cardType]])],2)]),C(ae,{modelValue:n.value.accountId,"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.accountId=t),options:$.value,label:"Account",required:""},null,8,["modelValue","options"]),C(R,{modelValue:n.value.label,"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.label=t),label:"Label",placeholder:"Payment Label"},null,8,["modelValue"])]}),_:1}))}},Le={class:"text-2xl text-primary dark:text-teal-400 font-black"},Me=["value"],Se={class:"font-bold"},Fe={class:"font-bold text-red-500 dark:text-red-400"},Pe={class:"flex justify-between bg-orange-500/10 -mx-4 mt-2 px-4 py-2 -mb-10 rounded-b-xl"},Ve={class:"text-lg font-bold"},Ie={class:"text-right"},Be={class:"text-lg font-bold"},Ue={class:"text-center"},je=["disabled"],Ne={__name:"AmountCard",props:{account:{type:Object,default:null}},emits:["refresh"],setup(s){const h=()=>{var l;(l=document.querySelector("#accounts-pay-modal"))==null||l.showModal()};return(l,d)=>{var D,f,n,$,k,b,y,u,a,o,r,t,m,v,i,g;return p(),w("div",{class:T(["bg-white dark:bg-gray-700 rounded-xl shadow-xl z-[2] relative -mt-10 p-4 mb-12",{"shadow-orange-500/20 dark:shadow-orange-700/10":((D=s.account)==null?void 0:D.type)==="Credit","shadow-secondary/20 dark:shadow-secondary/10":((f=s.account)==null?void 0:f.type)==="Debit"}])},[e("p",null,[e("small",null,c(((n=s.account)==null?void 0:n.type)=="Credit"?"Remaining Credits":"Balance"),1)]),e("p",Le,c(x(L)((($=s.account)==null?void 0:$.type)=="Credit"?((k=s.account)==null?void 0:k.creditLimit)-((b=s.account)==null?void 0:b.balance):(y=s.account)==null?void 0:y.amount)),1),((u=s.account)==null?void 0:u.type)==="Credit"?(p(),w(z,{key:0},[e("progress",{class:"progress progress-primary dark:bg-teal-500/30 dark:text-teal-200 w-full",value:((a=s.account)==null?void 0:a.balance)/((o=s.account)==null?void 0:o.creditLimit)*100||0,max:"100"},null,8,Me),e("p",Se,[e("small",null,"Statement Date: "+c(new Date(new Date().setDate(((r=s.account)==null?void 0:r.statementDay)||1)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})),1)]),e("p",Fe,[e("small",null,"Due Date: "+c((()=>{var B;const M=new Date;return M.setDate(((B=s.account)==null?void 0:B.statementDay)||1),M.setDate(M.getDate()+20),M.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})()),1)]),e("div",Pe,[e("div",null,[d[1]||(d[1]=e("p",{class:"font-bold"},[e("small",null,"Credit Limit")],-1)),e("p",Ve,c(x(L)((t=s.account)==null?void 0:t.creditLimit)),1)]),e("div",Ie,[d[2]||(d[2]=e("p",{class:"font-bold"},[e("small",null,"Balance")],-1)),e("p",Be,c(x(L)((m=s.account)==null?void 0:m.balance)),1)])]),e("div",Ue,[e("button",{disabled:!((v=s.account)!=null&&v.balance),class:T(["btn btn-circle btn-primary bg-linear-to-t from-teal-800 to-teal-500 outline-2 outline-offset-2 outline-primary btn-md text-white font-bold shadow-xl -mb-16 -mt-4 shadow-primary/50",{"grayscale-100":!((i=s.account)!=null&&i.balance)}]),onClick:h}," Pay ",10,je)])],64)):S("",!0),(g=s.account)!=null&&g.balance?(p(),I(Te,{key:1,account:s.account,onRefresh:d[0]||(d[0]=M=>l.$emit("refresh"))},null,8,["account"])):S("",!0)],2)}}},Re={class:"relative -mx-5 -mt-2 p-5 min-h-48"},Ye={class:"relative z-[2] max-w-10/12 h-full"},ze={class:"w-14 h-12 bg-white dark:bg-gray-800 px-2 py-1 mb-2 rounded-md"},Ae=["src","alt"],Oe={class:"text-white text-xl font-black"},qe={class:"w-6/12 h-10/12 absolute top-6/12 right-5 -translate-y-6/12 z-[0]"},Ee=["src","alt"],Je={class:"border-2 border-dashed bg-gray-200 border-gray-300 rounded-xl p-2 mb-8 dark:bg-gray-800"},We={class:"italic"},tt=H({__name:"View",setup(s){const h=X(),l=_(null),d=async()=>{l.value=await V("accounts",h.params.id)};return P(()=>{d()}),(D,f)=>(p(),I(Q,{pageTitle:(l.value?l.value.type:"")+" Account",isSubNav:"",bg:"bg-gray-100 dark:bg-gray-900"},{default:A(()=>{var n,$,k,b,y,u,a,o;return[e("div",Re,[e("div",Ye,[e("div",ze,[e("img",{src:x(N)((n=l.value)==null?void 0:n.cardType),alt:($=l.value)==null?void 0:$.cardType,class:"w-full h-full object-contain"},null,8,Ae)]),e("h2",Oe,c(((k=l.value)==null?void 0:k.name)||"Account"),1)]),e("div",{class:T(["w-full h-full bg-linear-to-r absolute top-0 left-0 z-[1] backdrop-blur-xs",{"from-secondary to-secondary/50":((b=l.value)==null?void 0:b.type)==="Debit","from-warning to-warning/50":((y=l.value)==null?void 0:y.type)==="Credit","from-gray-500 to-gray-500/50":!l.value}])},null,2),e("div",qe,[e("img",{src:x(N)((u=l.value)==null?void 0:u.bank),alt:(a=l.value)==null?void 0:a.bank,class:"w-full h-full object-contain"},null,8,Ee)])]),C(Ne,{account:l.value,onRefresh:d},null,8,["account"]),e("div",Je,[f[0]||(f[0]=e("p",{class:"font-bold text-xs"},"Note:",-1)),e("p",We,c(((o=l.value)==null?void 0:o.comment)||"--"),1)]),C(fe,{account:l.value},null,8,["account"])]}),_:1},8,["pageTitle"]))}});export{tt as default};
